<script>
(function(win, lib) {
	if (lib.callapp) return;
	var ua = navigator.userAgent;
	var browser = {
		isSafari: /Version\/[\d\.]+.*Safari/.test(ua),
		// isChrome: /Chrome/i.test(ua),
		chromeV: ua.match(/Chrome\/(\d+)/),
		isAndroid: /Android/i.test(ua),
		isIOS: /iPhone|iPad|iPod/i.test(ua),
		isWechat: /MicroMessenger/i.test(ua),
		iosVersion: function () {
			if (/iP(hone|od|ad)/.test(navigator.platform)) {
				var v = (navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);
				return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || 0, 10)];
			}
			return null;
		}
	};

	/**
	 * 插入微信提示
	 */
	function writeWechatTip() {
		document.body = document.createElement('body');
		var divEle = document.createElement("div");
		divEle.className = "wechat-tip";
		divEle.id = "JwechatTip";
		divEle.innerHTML = '<img style="position:absolute; width:100%; height:100%; z-index:-1;background-size: cover;" src="https://linkedme.cc/i/app/android_platform_tip/12291" height="100%" width="100%" />'
		document.body.appendChild(divEle);
		divEle.addEventListener("click",function(){
			divEle.style.display = "none";
		},false);
	}

	lib.callapp = function(o) {
		if (!o || typeof(o) != "object") return;
		if (typeof(o.scheme) == "undefined" || o.scheme == "") return;
		if (typeof(o.package) == "undefined" || o.package == "") return;
		if (typeof(o.schemeUrl) != "undefined" && o.schemeUrl != "") {
			if (browser.isAndroid) {
				if (browser.isWechat) {
					writeWechatTip();
				} else {
					var url = window.location.search; //获取url中"?"符后的字串
					url.indexOf('?');
					o.schemeUrl += url.substr(0);
					o.schemeUrl = o.schemeUrl.replace(/pcautobrowser:/,"intent:") + "#Intent;scheme=" + o.scheme + ";package=" + o.package + ";end";
					win.location.href = o.schemeUrl;
					if (typeof(o.dowmloadUrl) != "undefined" && o.dowmloadUrl != "") {
						var t = Date.now();
						var timeload = setTimeout(function() {
							if (Date.now() - t < 1600) {
								win.location.href = o.dowmloadUrl;
							}
						}, 1000);
					};
				}
			} else { //for pc test
				writeWechatTip();
				console.log("scheme: %s", o.schemeUrl);
			};
		};
	}
})(window, window.lib || (window.lib = {}));
</script>

<script type="text/javascript">
function loadCallapp(fn) {
	fn = fn || function() {};
	if (window.lib && typeof(window.lib.callapp) != "undefined") {
		fn();
	}else {
		var script = document.createElement("script");
		script.setAttribute("type", "text/javascript");
		script.setAttribute("src", "callapp.js");
		document.getElementsByTagName("head")[0].appendChild(script);
		script.onload = script.onreadystatechange = function() {
			var f = script.readyState;
			if (f && f != "loaded" && f != "complete") return;
			script.onload = script.onreadystatechange = null;
			fn();
		};
	};
}

lib.callapp({
	"scheme":"ice",
	"package":"com.huawei.pcassistant",
	"schemeUrl":"ice://start.mainactivity?",
	"cachedUrl":"img/favicon.ico",
	"dowmloadUrl":"img/MateTrans1229_80_3.apk"
});

</script>
